@model Order

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <h2 class="text-center" style="font-size: 46px; line-height: 54px; color: #222;">Thanh Toán</h2>
            <form asp-action="Checkout" method="post">
                <div class="mb-3">
                    <label for="ShippingAddress" class="form-label">Địa chỉ giao hàng</label>
                    <input type="text" id="ShippingAddress" name="ShippingAddress" class="form-control" placeholder="Nhập địa chỉ giao hàng">
                    <div id="map" style="height: 700px; margin-top: 10px;"></div>

                <div class="mb-3">
                    <label class="form-label">Phương thức thanh toán</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="PaymentMethod" id="cashPayment" value="Tiền mặt">
                        <label class="form-check-label" for="cashPayment">
                            Tiền mặt
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="PaymentMethod" id="onlinePayment" value="Online" disabled>
                        <label class="form-check-label" for="onlinePayment">
                            Online
                        </label>
                    </div>
                    <label for="Notes" class="form-label">Ghi chú</label>
                    <textarea id="Notes" name="Notes" class="form-control" placeholder="Nhập ghi chú của bạn" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">Đặt hàng</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet" />

    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
          href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css"
          type="text/css" />
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiamF1aGFybXVoYW1tZWQiLCJhIjoiY2xjMWl6c3VtMGxkYzNwbGs2dWVidDVsZCJ9.1Lyl-BoNItxbKW9_j3c-QA';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [105.8523, 21.0285], // Tọa độ mặc định
            zoom: 12
        });

        const geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl
        });

        map.addControl(geocoder);

        map.on('load', function () {
            map.addSource('single-point', {
                type: 'geojson',
                data: {
                    type: 'FeatureCollection',
                    features: []
                }
            });

            map.addLayer({
                id: 'point',
                source: 'single-point',
                type: 'circle',
                paint: {
                    'circle-radius': 10,
                    'circle-color': '#007cbf'
                }
            });

            map.on('click', async function (e) {
                const coordinates = [e.lngLat.lng, e.lngLat.lat];
                const response = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${coordinates[0]},${coordinates[1]}.json?access_token=${mapboxgl.accessToken}`);
                const data = await response.json();
                const address = data.features[0].place_name;
                document.getElementById('ShippingAddress').value = address;
                map.getSource('single-point').setData({
                    type: 'FeatureCollection',
                    features: [{
                        type: 'Feature',
                        geometry: {
                            type: 'Point',
                            coordinates: coordinates
                        }
                    }]
                });
            });
        });

        // jQuery fade in effect
        $(document).ready(function () {
            $('div.container').hide().fadeIn(1000);
        });

        // Hiển thị thông báo khi chọn phương thức thanh toán Online
        $(document).ready(function () {
            $('#onlinePayment').change(function () {
                if ($(this).is(':checked')) {
                    alert('Chức năng đang được cập nhật. Vui lòng thử lại sau.');
                }
            });
        });
    </script>
}
